title: JS位运算的巧妙运用
date: 2015-08-10 19:11:56
tags: [js,位运算,代码优化]
categories: [javascript,代码优化]
keywords: js,javascript,代码优化,位运算
---
位运算,对于底层的`C`,`C++`开发人员来说并不陌生,但是对于`js`这门弱语言来说,位运算总感觉是那么高深.那么我们为什么还要用位运算呢?

首先,编程语言都是通过机器语言,汇编语言,C,C++,Java等这样一层一层封装出来的,每次封装对于开发人员来说代码的阅读性更好了,但是计算机在"阅读"这些代码的时候还是会一级一级的转换回去才能执行这些指令,所以我们越容易读懂的代码,计算机的执行效率就越低.尽管科技越来越发达,硬件方面的技术很强,但是这些小小的优化并不是杯水车薪.
其次,可以装逼.在一些小菜鸟面前用这些他们看不懂的代码,很装逼,有木有.

<!--more-->

具体的位运算涉及到二进制转换,原码,反码,补码等知识,就不一一罗列,而且在`js`中用处很小,只需要了解运用下面几点东西就OK了.

### 1. 奇偶性判断------按位与(&)

按位与运算是把两个操作数转换成二进制再逐位比较,相同其结果为1,否则为0.而所有数字转化为二进制的奇偶性就只用看末尾,奇数尾数为1,偶数尾数为0.所以:

``` js
if ( a & 1 ) {
  alert( 'a是奇数!' );
} else {  
  alert ( 'a是偶数!' )
}
```
<a name="change-number" id="change-number"></a>
### 2. 两个整数的互换------按位异或(^) 

加减互为逆运算,异或和异或互为逆运算.

利用加减:
``` js
var a = 1;
var b = 2;
a = a + b;
b = a - b;
a = a - b;
console.log(a,b)
```

按位异或:
``` js
var a = 1;
var b = 2;
a = a ^ b;
b = a ^ b;
a = a ^ b;
console.log(a,b);
```

两个整数互换可以申明第三个中间变量进行临时存储实现,但是声明变量会占用内存,不友好.而加减又没有位运算效率高.

### 3. -1的判断------按位取反(~)

判断一个数是否为-1是我们经常遇到的,`indexOf()`在查找字符串的时候没有找到会返回-1,很多程序,插件,框架错误状态值默认返回-1,前后端分离`ajax`请求有误的时候返回-1(这个一般是一个项目中统一规定,当然也有返回0的,我们这里不做讨论).在位运算中,**`~-1===0`**的.
``` js
// 以前
if ( str.indexOf('a') != -1 ) {
  alert('a在字符串str中');
}

// 现在
if ( ~str.indexOf('a') ) {
  alert('a在字符串str中');
}
```

``` js
// 以前
$.get(url, data, function(data) {
  if( data.status != -1 ) {
    // 数据正常处理
  } else {
    // 数据有误处理
  }
});

//现在
$.get(url, data, function(data) {
  if( ~data.status ) {
    // 数据正常处理
  } else {
    // 数据有误处理
  }
});
```

### 4. 非负数取整------无符号右移(>>>)

很多时候我们遇到正整数去掉(注意,不是四舍五入)小数点,一般会用到`Math.floor()`;
``` js
// 以前
Math.floor(3.52);  // 结果 3

// 现在
3.53 >>> 0;  // 结果 3
```

### 5. 取中间一位数------无符号右移(>>>)

很多时候我们会遇到取中间一位数,偶数就取中间偏左一位.如: 在一列翻页页码标签中,活跃的(active)始终在中间,要取得中间一位是第几位.(总共5个则第取3个,总共8个则取第4个).

``` js
// 以前 
if ( totalPages是偶数 ) {
  alert( '中间一位是第' + totalPage/2 +'位' );
} else {
  alert( '中间一位是第' + (totalPage + 1)/2 +'位' );
}

// 现在
alert( '中间一位是第' + ( totalPage >>> 1 ) +'位' );
```
总之,还有很多位运算方面技巧性的代码写法,有兴趣可以取研究研究.

**PS:位运算只针对于非NaN的Number数据类型,对于非Number数据会被强制隐式转换成数字0再进行计算,同时位运算的优先级很低,注意需要加上括号增加优先级**